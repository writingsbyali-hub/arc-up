---
// ====================================================================
// ARCUP HEADER - UPDATED STRUCTURE
// Progressive disclosure navigation: Home → About → Research → Pathways → Get Started → Workspace
// External links moved to footer for cleaner header experience.
// ====================================================================
import AnimatedLogo from '~/components/ui/AnimatedLogo.astro';
import ToggleTheme from '~/components/common/ToggleTheme.astro';
import ToggleMenu from '~/components/common/ToggleMenu.astro';
import { getHomePermalink, getPermalink } from '~/utils/permalinks';

// Navigation following the user journey
const navList = [
  { text: 'home', href: getHomePermalink() },
  { text: 'about', href: getPermalink('/about') },
  { text: 'research', href: getPermalink('/research') },
  { text: 'projects', href: getPermalink('/projects') },
  { text: 'get started', href: getPermalink('/get-started') },
];

export interface Props {
  id?: string;
  isSticky?: boolean;
  isFullWidth?: boolean;
  showToggleTheme?: boolean;
}

const {
  id = 'header',
  isSticky = true,
  isFullWidth = false,
  showToggleTheme = false,
} = Astro.props;

// Get current path for active state
const currentPath = Astro.url.pathname;
---

<header
  class:list={[
    { sticky: isSticky, relative: !isSticky },
    'top-0 z-40 flex-none mx-auto w-full border-b border-gray-700/70 backdrop-blur-sm transition-all duration-100 ease-in-out bg-primary-900/90',
  ]}
  {...isSticky ? { 'data-aw-sticky-header': true } : {}}
  {...id ? { id } : {}}
>
  <div class="absolute inset-0 bg-primary-900/80"></div>
  <div
    class:list={[
      'relative text-white py-3 px-3 md:px-6 mx-auto w-full md:flex md:justify-between md:items-center',
      {
        'max-w-7xl': !isFullWidth,
      },
    ]}
  >
    <!-- Logo Section -->
    <div class="flex justify-between items-center">
      <a class="flex items-center gap-2 rounded focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-arc-electric focus-visible:ring-offset-2 focus-visible:ring-offset-primary-900" href={getHomePermalink()}>
        <AnimatedLogo size="sm" showMark={false} animation="playful" />
        <span class="text-sm text-gray-400 font-mono">byali</span>
      </a>
      <div class="flex items-center md:hidden">
        {showToggleTheme && <ToggleTheme iconClass="w-6 h-6" />}
        <ToggleMenu />
      </div>
    </div>

    <!-- Navigation Section -->
    <nav
      class="items-center w-full md:w-auto hidden md:flex text-md overflow-y-auto overflow-x-hidden md:overflow-visible"
      aria-label="Main navigation"
    >
      <ul class="flex flex-col md:flex-row md:self-center w-full md:w-auto text-white">
        {
          navList.map(({ text, href, target }) => {
            // Check if this nav item is active
            const isActive = currentPath === href ||
                           (href !== '/' && currentPath.startsWith(href));

            return (
              <li class="flex items-stretch md:items-center">
                <a
                  class:list={[
                    'font-mono px-6 py-4 md:px-4 md:py-1 transition duration-150 ease-in-out rounded focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-arc-electric focus-visible:ring-offset-2 focus-visible:ring-offset-primary-900 flex items-center w-full md:w-auto',
                    isActive
                      ? 'text-arc-electric font-bold'
                      : 'hover:text-arc-electric'
                  ]}
                  href={href}
                  {...(target ? { target } : {})}
                  {...(isActive ? { 'aria-current': 'page' } : {})}
                >
                  {text}
                  {target && <span class="ml-1 text-sm opacity-60">↗</span>}
                </a>
              </li>
            );
          })
        }
      </ul>
      {showToggleTheme && (
        <div class="flex items-center md:ml-4">
          <ToggleTheme iconClass="w-6 h-6" />
        </div>
      )}
    </nav>
  </div>
</header>
