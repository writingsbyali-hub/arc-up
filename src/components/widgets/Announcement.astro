---
export interface Props {
  id?: string;
}

const { id = 'announcement' } = Astro.props;
---

<div
  {...id ? { id } : {}}
  class="bg-primary-900 border-b border-living-earth/30 backdrop-blur-sm flex justify-center items-center px-3 py-3 md:py-2.5 cursor-pointer hover:bg-primary-900/80 transition-all group"
  role="button"
  tabindex="0"
  aria-label="Take the 2-minute tour to learn about arc^"
>
  <span
    class="bg-living-earth/20 border border-living-earth/40 text-living-earth font-mono font-bold px-2 py-0.5 text-xs mr-2 inline-block rounded uppercase"
    >NEW TO ARC^?</span
  >
  <span class="text-white font-mono text-sm group-hover:text-living-earth transition-colors"
    >Take the 2-minute tour â†’</span
  >
</div>

<script is:inline>
  function initAnnouncement() {
    const announcement = document.getElementById('announcement');

    if (!announcement) {
      console.log('Announcement element not found');
      return;
    }

    // Check if already initialized
    if (announcement.dataset.initialized === 'true') {
      return;
    }

    // Make announcement clickable to open tour
    const openTour = (e) => {
      e.preventDefault();
      const tourButton = document.getElementById('tour-button');
      if (tourButton) {
        console.log('Opening tour from announcement');
        tourButton.click();
      } else {
        console.log('Tour button not found');
      }
    };

    announcement.addEventListener('click', openTour);
    announcement.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        openTour(e);
      }
    });

    // Mark as initialized
    announcement.dataset.initialized = 'true';
    console.log('Announcement initialized');
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAnnouncement);
  } else {
    initAnnouncement();
  }

  document.addEventListener('astro:after-swap', () => {
    setTimeout(initAnnouncement, 100);
  });
</script>
