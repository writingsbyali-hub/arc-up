---
export interface Props {
  id?: string;
}

const { id = 'announcement' } = Astro.props;
---

<div
  {...id ? { id } : {}}
  class="bg-primary-900 border-b border-living-earth/30 backdrop-blur-sm flex justify-center items-center px-3 py-3 md:py-2.5 cursor-pointer hover:bg-primary-900/80 transition-all group relative z-50"
  role="button"
  tabindex="0"
  aria-label="Take the 2-minute tour to learn about arc^"
  data-announcement-trigger
  style="pointer-events: auto;"
>
  <span
    class="bg-living-earth/20 border border-living-earth/40 text-living-earth font-mono font-bold px-2 py-0.5 text-xs mr-2 inline-block rounded uppercase"
    >NEW TO ARC^?</span
  >
  <span class="text-white font-mono text-sm group-hover:text-living-earth transition-colors"
    >Take the 2-minute tour â†’</span
  >
</div>

<script>
  function setupAnnouncementClick() {
    const announcement = document.querySelector('[data-announcement-trigger]');
    if (!announcement) return;

    // Function to trigger tour
    const triggerTour = () => {
      const tourButton = document.getElementById('tour-button');
      if (tourButton) {
        tourButton.click();
      }
    };

    // Wait for tour button to exist using MutationObserver
    const waitForTourButton = () => {
      const tourButton = document.getElementById('tour-button');

      if (tourButton) {
        // Tour button exists, attach handlers
        announcement.onclick = triggerTour;
        announcement.onkeydown = (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            triggerTour();
          }
        };
      } else {
        // Tour button doesn't exist yet, watch for it
        const observer = new MutationObserver(() => {
          const btn = document.getElementById('tour-button');
          if (btn) {
            announcement.onclick = triggerTour;
            announcement.onkeydown = (e) => {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                triggerTour();
              }
            };
            observer.disconnect();
          }
        });

        observer.observe(document.body, {
          childList: true,
          subtree: true
        });
      }
    };

    waitForTourButton();
  }

  // Run on different events
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupAnnouncementClick);
  } else {
    setupAnnouncementClick();
  }

  document.addEventListener('astro:after-swap', setupAnnouncementClick);
  document.addEventListener('astro:page-load', setupAnnouncementClick);
</script>
