---
import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Announcement from '~/components/widgets/Announcement.astro';
import { getPermalink } from '~/utils/permalinks';
import { Icon } from 'astro-icon/components';

const featuresTheChallenge = [
  {
    icon: 'tabler:lock',
    title: 'The Knowledge Lock',
    description: 'Innovation slows when knowledge is kept behind walls.',
    responseTitle: 'The ARC^ Response',
    response: 'ARC^ opens blueprints so people everywhere can build together.',
  },
  {
    icon: 'tabler:world',
    title: 'The Planetary Drift',
    description: 'Ecosystems unravel faster than any field can respond alone.',
    responseTitle: 'The ARC^ Response',
    response: 'ARC^ links plasma research with shared action for ecological repair.',
  },
];
---

<Layout>
  <Announcement />
  <div class="bg-primary-900 text-white min-h-screen">
    <Hero
      tagline="open plasma research for ecological regeneration"
      actions={[
        {
          variant: 'primary',
          text: 'EXPLORE PATHWAYS',
          href: '/projects',
          class: 'bg-arc-electric hover:bg-arc-electric/80 hover:scale-105 text-base md:text-lg px-6 md:px-8 py-3 md:py-4 transition-all focus:ring-2 focus:ring-arc-electric focus:ring-offset-2 focus:ring-offset-primary-900',
        },
      ]}
      bg="bg-primary-900 bg-[radial-gradient(ellipse_at_top,_var(--tw-color-primary-900,rgba(8,14,33,1))_5%,_#000000_100%)]"
    >
      <Fragment slot="title">
        <span class="font-mono ">building futures worth inheriting</span> 
      </Fragment>
      <Fragment slot="subtitle">
        <span>
          For those ready to build a better world:<br/>
          scientifically, experimentally, collaboratively, openly.
        </span>
      </Fragment>
      <Fragment slot="content">
        <div class="mt-8 text-center">
          <p class="text-sm text-gray-400 mb-4">Quick access for returning builders:</p>
          <nav aria-label="Quick access navigation" class="flex flex-col sm:flex-row flex-wrap justify-center gap-3 sm:gap-4 text-sm">
            <a href={getPermalink('/lab')} class="text-yellow-400 hover:text-yellow-300 transition font-mono hover:underline py-2 sm:py-0 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-offset-2 focus:ring-offset-primary-900 rounded">Lab</a>
            <span class="text-gray-600 hidden sm:inline" aria-hidden="true">|</span>
            <a href={getPermalink('/framework')} class="text-green-400 hover:text-green-300 transition font-mono hover:underline py-2 sm:py-0 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-offset-2 focus:ring-offset-primary-900 rounded">Framework</a>
            <span class="text-gray-600 hidden sm:inline" aria-hidden="true">|</span>
            <a href={getPermalink('/commons')} class="text-blue-400 hover:text-blue-300 transition font-mono hover:underline py-2 sm:py-0 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:ring-offset-primary-900 rounded">Commons</a>
          </nav>
        </div>
      </Fragment>
    </Hero>

    <!-- Systems Section (Lighter background) -->
    <section aria-labelledby="systems-heading" class="py-6 md:py-10 bg-gray-800/40 backdrop-blur-sm border-b border-gray-700/50">
      <div class="max-w-6xl mx-auto px-4 sm:px-6">
        <div class="text-center pb-3 md:pb-4">
          <p class="text-xs font-mono text-arc-electric uppercase tracking-widest mb-2">why arc^ exists</p>
          <h2 id="systems-heading" class="text-xl md:text-2xl font-mono tracking-tight mb-2">the systems we're changing</h2>
          <p class="text-sm md:text-base text-gray-400 max-w-3xl mx-auto">
            The challenges we face are complex, not isolated.<br/>
            Repair depends on collaboration across disciplines and ecosystems alike.
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mt-6 intersect-once motion-safe:opacity-0 motion-safe:intersect:animate-fade">
          {
            featuresTheChallenge.map((feature) => (
              <div class="group p-5 md:p-6 rounded-xl bg-gray-900/30 backdrop-blur-sm shadow-xl border border-gray-700/50 hover:border-arc-electric/50 hover:bg-gray-900/40 transition-all duration-300 text-center">
                <div class="mb-4 flex justify-center" role="img" aria-label={`${feature.title} icon`}>
                  <Icon name={feature.icon} class="w-12 h-12 md:w-14 md:h-14 text-arc-electric" />
                </div>
                <h3 class="text-lg md:text-xl font-mono text-white mb-3">{feature.title}</h3>
                <p class="text-sm text-gray-350 leading-relaxed">{feature.description}</p>

                <div class="mt-5 pt-4 border-t-2 border-living-earth/20">
                  <div class="flex items-center justify-center gap-2 mb-2">
                    <div class="h-0.5 w-6 bg-living-earth"></div>
                    <h4 class="font-bold text-living-earth text-sm md:text-base">{feature.responseTitle}</h4>
                    <div class="h-0.5 w-6 bg-living-earth"></div>
                  </div>
                  <p class="text-sm text-gray-200 leading-relaxed" set:html={feature.response}></p>
                </div>
              </div>
            ))
          }
        </div>
      </div>
    </section>

    <!-- Dual-Purpose CTA Section -->
    <section class="py-8 md:py-12 bg-[radial-gradient(circle_at_top,#181f3d_0%,#080E21_90%)] border-t border-gray-800/30">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 text-center">
        <div class="bg-[#131A33]/50 backdrop-blur-sm rounded-2xl shadow-2xl border border-gray-700/50 p-8 md:p-10">
          <h2 class="text-2xl md:text-3xl font-mono font-bold text-white mb-4">
            Ready to explore?
          </h2>
          <p class="text-base md:text-lg text-gray-300 mb-8 max-w-2xl mx-auto">
            Take the guided tour or dive straight into our projects
          </p>
          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <button
              id="tour-button"
              class="bg-arc-electric hover:bg-arc-electric/90 text-white px-6 md:px-8 py-3 md:py-4 rounded-lg font-mono font-bold transition-all hover:scale-105 hover:shadow-lg hover:shadow-arc-electric/50 focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-[#131A33] text-base md:text-lg"
            >
              Take the Tour
            </button>
            <a
              href={getPermalink('/projects')}
              class="bg-gray-700 hover:bg-gray-600 text-white px-6 md:px-8 py-3 md:py-4 rounded-lg font-mono font-bold transition-all hover:scale-105 focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-[#131A33] text-base md:text-lg inline-block"
            >
              Explore Projects
            </a>
          </div>
        </div>
      </div>
    </section>


  </div>

  <!-- Interactive Tour Modal -->
  <div id="tour-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 opacity-0 invisible transition-all duration-300">
    <div class="bg-primary-900 border-2 border-arc-electric rounded-2xl max-w-2xl w-full shadow-2xl shadow-arc-electric/20 transform scale-95 transition-all duration-300" id="tour-content">
      <div class="p-6 md:p-8">
        <!-- Tour Header -->
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center gap-3">
            <span id="tour-step-indicator" class="text-sm font-mono text-arc-electric">Step 1 of 3</span>
          </div>
          <button id="tour-close" class="text-gray-400 hover:text-white transition" aria-label="Close tour">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <!-- Tour Content (changes based on step) -->
        <div id="tour-body">
          <!-- Step 1: About -->
          <div class="tour-step" data-step="1">
            <h3 class="text-2xl md:text-3xl font-mono font-bold text-white mb-4">What is arc^?</h3>
            <p class="text-base md:text-lg text-gray-300 leading-relaxed mb-6">
              Arc^ is <strong class="text-white">open plasma research for ecological regeneration</strong>. We're building plasma technologies to repair damaged ecosystems—water, soil, and living systems—and sharing everything openly.
            </p>
            <p class="text-base text-gray-400 mb-6">
              No patents. No paywalls. Just collaborative science for planetary repair.
            </p>
            <a href="/about" class="text-arc-electric hover:text-arc-electric/80 font-mono underline">Read the full story →</a>
          </div>

          <!-- Step 2: Research -->
          <div class="tour-step hidden" data-step="2">
            <h3 class="text-2xl md:text-3xl font-mono font-bold text-white mb-4">How we work</h3>
            <p class="text-base md:text-lg text-gray-300 leading-relaxed mb-6">
              Our research spans <strong class="text-white">4 scales</strong>: from plasma physics to ecosystem dynamics. We design systems, test on water and soil, monitor biological responses, and model long-term impacts.
            </p>
            <div class="grid grid-cols-2 gap-4 mb-6">
              <div class="p-4 bg-gray-800/50 rounded-lg border border-gray-700/50">
                <p class="text-sm font-mono text-arc-electric mb-1">Scale 1</p>
                <p class="text-sm text-gray-300">Plasma tech</p>
              </div>
              <div class="p-4 bg-gray-800/50 rounded-lg border border-gray-700/50">
                <p class="text-sm font-mono text-living-earth mb-1">Scale 2</p>
                <p class="text-sm text-gray-300">Water systems</p>
              </div>
              <div class="p-4 bg-gray-800/50 rounded-lg border border-gray-700/50">
                <p class="text-sm font-mono text-blue-400 mb-1">Scale 3</p>
                <p class="text-sm text-gray-300">Organisms</p>
              </div>
              <div class="p-4 bg-gray-800/50 rounded-lg border border-gray-700/50">
                <p class="text-sm font-mono text-purple-400 mb-1">Scale 4</p>
                <p class="text-sm text-gray-300">Ecosystems</p>
              </div>
            </div>
            <a href="/research" class="text-arc-electric hover:text-arc-electric/80 font-mono underline">See our research approach →</a>
          </div>

          <!-- Step 3: Pathways -->
          <div class="tour-step hidden" data-step="3">
            <h3 class="text-2xl md:text-3xl font-mono font-bold text-white mb-4">Where you fit</h3>
            <p class="text-base md:text-lg text-gray-300 leading-relaxed mb-6">
              We organize our work into <strong class="text-white">3 pillars</strong>. Each one needs different skills and perspectives.
            </p>
            <div class="space-y-3 mb-6">
              <div class="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                <p class="font-mono font-bold text-yellow-400 mb-1">Lab</p>
                <p class="text-sm text-gray-300">Build & test plasma systems</p>
              </div>
              <div class="p-4 bg-green-400/10 border border-green-400/30 rounded-lg">
                <p class="font-mono font-bold text-green-400 mb-1">Framework</p>
                <p class="text-sm text-gray-300">Develop protocols & governance</p>
              </div>
              <div class="p-4 bg-blue-400/10 border border-blue-400/30 rounded-lg">
                <p class="font-mono font-bold text-blue-400 mb-1">Commons</p>
                <p class="text-sm text-gray-300">Share data & knowledge</p>
              </div>
            </div>
            <a href="/projects" class="text-arc-electric hover:text-arc-electric/80 font-mono underline">Explore all pathways →</a>
          </div>
        </div>

        <!-- Tour Navigation -->
        <div class="flex items-center justify-between mt-8 pt-6 border-t border-gray-700">
          <button id="tour-prev" class="px-4 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg font-mono transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            ← Previous
          </button>
          <button id="tour-next" class="px-6 py-2 bg-arc-electric hover:bg-arc-electric/90 text-white rounded-lg font-mono font-bold transition">
            Next →
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Back to Top Button -->
  <button
    id="back-to-top"
    class="fixed bottom-6 right-6 bg-arc-electric hover:bg-arc-electric/90 text-white p-4 rounded-full shadow-2xl shadow-arc-electric/40 opacity-0 invisible transition-all duration-300 z-50 hover:scale-110"
    aria-label="Back to top"
  >
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
    </svg>
  </button>

  <script is:inline>
    function initHomePage() {
      // Interactive Tour
      const tourButton = document.getElementById('tour-button');
      const tourModal = document.getElementById('tour-modal');
      const tourContent = document.getElementById('tour-content');
      const tourClose = document.getElementById('tour-close');
      const tourPrev = document.getElementById('tour-prev');
      const tourNext = document.getElementById('tour-next');
      const tourStepIndicator = document.getElementById('tour-step-indicator');

      if (!tourButton || !tourModal) return; // Exit if elements don't exist

      let currentStep = 1;
      const totalSteps = 3;

      function showTourStep(step) {
        document.querySelectorAll('.tour-step').forEach(el => el.classList.add('hidden'));
        document.querySelector(`.tour-step[data-step="${step}"]`).classList.remove('hidden');
        tourStepIndicator.textContent = `Step ${step} of ${totalSteps}`;

        tourPrev.disabled = step === 1;
        if (step === totalSteps) {
          tourNext.textContent = 'Get Started →';
        } else {
          tourNext.textContent = 'Next →';
        }
      }

      function openTour() {
        tourModal.classList.remove('opacity-0', 'invisible');
        tourContent.classList.remove('scale-95');
        tourContent.classList.add('scale-100');
        document.body.style.overflow = 'hidden';
      }

      function closeTour() {
        tourModal.classList.add('opacity-0', 'invisible');
        tourContent.classList.add('scale-95');
        tourContent.classList.remove('scale-100');
        document.body.style.overflow = '';
        currentStep = 1;
        showTourStep(1);
      }

      tourButton?.addEventListener('click', openTour);
      tourClose?.addEventListener('click', closeTour);
      tourModal?.addEventListener('click', (e) => {
        if (e.target === tourModal) closeTour();
      });

      tourPrev?.addEventListener('click', () => {
        if (currentStep > 1) {
          currentStep--;
          showTourStep(currentStep);
        }
      });

      tourNext?.addEventListener('click', () => {
        if (currentStep < totalSteps) {
          currentStep++;
          showTourStep(currentStep);
        } else {
          window.location.href = '/get-started';
        }
      });

      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (!tourModal.classList.contains('invisible')) {
          if (e.key === 'Escape') closeTour();
          if (e.key === 'ArrowRight' && currentStep < totalSteps) {
            currentStep++;
            showTourStep(currentStep);
          }
          if (e.key === 'ArrowLeft' && currentStep > 1) {
            currentStep--;
            showTourStep(currentStep);
          }
        }
      });

      // Smooth scroll for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          const href = this.getAttribute('href');
          if (href === '#') return;

          e.preventDefault();
          const target = document.querySelector(href);
          if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        });
      });

      // Back to top button logic
      const backToTopButton = document.getElementById('back-to-top');
      if (backToTopButton) {
        window.addEventListener('scroll', () => {
          if (window.scrollY > 500) {
            backToTopButton.classList.remove('opacity-0', 'invisible');
            backToTopButton.classList.add('opacity-100', 'visible');
          } else {
            backToTopButton.classList.add('opacity-0', 'invisible');
            backToTopButton.classList.remove('opacity-100', 'visible');
          }
        });

        backToTopButton.addEventListener('click', () => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }
    }

    // Initialize on first load
    document.addEventListener('DOMContentLoaded', initHomePage);

    // Reinitialize after navigation (view transitions)
    document.addEventListener('astro:after-swap', initHomePage);
  </script>
</Layout>
